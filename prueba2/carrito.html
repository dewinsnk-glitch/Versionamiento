<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carrito de Compras</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="pantalla-catalogo">
    <header class="header">
      <div class="logo-header">
        <img src="gancho-de-ropa.png" alt="Logo">
        <div class="titulo-lumen">
          <strong>LUMEN</strong><br>
          <span>ROPA CON ESTILO</span>
        </div>
      </div>
      <div class="menu-icon" id="menuToggle">‚ò∞</div>
    </header>

        <!-- Men√∫ desplegable -->
    <nav class="menu-desplegable" id="menu">
      <ul>
        <li><a href="catalogo.html">Inicio</a></li> <!--Redireccionamiento al inicio/catalogo-->
        <li><a href="carrito.html">Carrito de compra</a></li> <!--Redireccionamiento a carrito de compra-->
        <li><a href="histcompra.html">Historial de compra</a></li> <!--Redireccionamiento al historial de compra-->
        <li><a href="perfil.html">Perfil</a></li> <!--Redireccionamiento a Perfil-->
        <li><a href="index.html">Cerrar sesi√≥n</a></li> <!--Redireccionamiento a Login-->
      </ul>
    </nav>

    <main class="carrito-grid">
      <h2>CARRITO DE COMPRAS</h2>
      <div id="contenedorCarrito" class="carrito-contenido"></div>

      <div class="carrito-acciones">
        <button id="btnFinalizar" class="btn-finalizar">Finalizar compra</button>
        <span id="totalCarrito"></span>
      </div>
    </main>
  </div>

  <script>
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const contenedor = document.getElementById("contenedorCarrito");
    const totalCarrito = document.getElementById("totalCarrito");

    function renderizarCarrito() {
      contenedor.innerHTML = "";
      let total = 0;

      carrito.forEach((producto, index) => {
        const nombre = producto.nombre || "Producto";
        const imagen = producto.imagen || "https://via.placeholder.com/60";
        const cantidad = producto.cantidad || 1;
        const precio = 10; // Puedes ajustarlo
        const subtotal = cantidad * precio;
        total += subtotal;

        const div = document.createElement("div");
        div.classList.add("item-carrito");

        div.innerHTML = `
          <input type="checkbox">
          <img src="${imagen}" alt="${nombre}">
          <span class="nombre">${nombre}</span>
          <input type="number" min="1" value="${cantidad}" class="cantidad" data-index="${index}">
          <span class="subtotal">$${subtotal}</span>
          <button class="eliminar" data-index="${index}">üóëÔ∏è</button>
        `;
        contenedor.appendChild(div);
      });

      totalCarrito.textContent = `Total: $${total}`;
    }

    contenedor.addEventListener("input", function(e) {
      if (e.target.classList.contains("cantidad")) {
        const index = e.target.dataset.index;
        carrito[index].cantidad = parseInt(e.target.value);
        localStorage.setItem("carrito", JSON.stringify(carrito));
        renderizarCarrito();
      }
    });

    contenedor.addEventListener("click", function(e) {
      if (e.target.classList.contains("eliminar")) {
        const index = e.target.dataset.index;
        carrito.splice(index, 1);
        localStorage.setItem("carrito", JSON.stringify(carrito));
        renderizarCarrito();
      }
    });

  document.getElementById("btnFinalizar").addEventListener("click", () => {
    // Crear registro de compra para el historial
    const fecha = new Date().toLocaleString();
    const historial = JSON.parse(localStorage.getItem("historialCompras")) || [];

    const compra = {
      fecha,
      productos: carrito.map(p => ({
        nombre: p.nombre,
        cantidad: p.cantidad || 1,
        precio: 10 // mismo precio base que usas en el carrito
      })),
      total: carrito.reduce((acc, p) => acc + (p.cantidad || 1) * 10, 0)
  };

  // Guardar la compra en el historial
  historial.push(compra);
  localStorage.setItem("historialCompras", JSON.stringify(historial));

  // Limpiar carrito y redirigir
  alert("¬°Gracias por tu compra!");
  localStorage.removeItem("carrito");
  window.location.href = "catalogo.html";
});


    renderizarCarrito();
  </script>
  <script>
  const menuToggle = document.getElementById("menuToggle");
  const menu = document.getElementById("menu");

  menuToggle.addEventListener("click", () => {
    menu.classList.toggle("visible");
  });
</script>
</body>
</html>

